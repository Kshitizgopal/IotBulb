<!DOCTYPE html>
<html>
<head>
    <title>ESP32 Firebase Auth Control</title>
    <meta charset="UTF-8">
</head>
<body>
    <h2>ESP32 Firebase Auth Control</h2>

    <!-- Login Form -->
    <div id="loginForm">
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button id="loginBtn">Login</button>
    </div>

    <hr>

    <!-- Controls (only visible after login) -->
    <div id="controls" style="display:none;">
        <h3>Light Control</h3>
        <button onclick="setLight(true)">Turn ON</button>
        <button onclick="setLight(false)">Turn OFF</button>
        <p>Light Status: <span id="lightStatus">Unknown</span></p>
        <button onclick="logout()">Logout</button>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>
    <script src="config.js"></script> <!-- Firebase config in separate file -->

    <script>
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Login button click
        document.getElementById("loginBtn").addEventListener("click", () => {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    document.getElementById("loginForm").style.display = "none";
                    document.getElementById("controls").style.display = "block";
                    listenLightStatus();
                })
                .catch((error) => {
                    alert("Login failed: " + error.message);
                });
        });

        // Set light value
        function setLight(state) {
            database.ref("light").set(state);
        }

        // Listen for light value changes
        function listenLightStatus() {
            database.ref("light").on("value", (snapshot) => {
                const status = snapshot.val();
                document.getElementById("lightStatus").innerText = status ? "ON" : "OFF";
            });
        }

        // Logout
        function logout() {
            auth.signOut().then(() => {
                document.getElementById("controls").style.display = "none";
                document.getElementById("loginForm").style.display = "block";
            });
        }
    </script>
</body>
</html>
